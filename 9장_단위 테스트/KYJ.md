9장 단위 테스트
========


### TDD 법칙 세가지
>TDD(Test-Drieven Development)는 실제 코드를 짜기 전에 단위 테스트부터 짜라고 요구한다.  
TDD의 3가지 법칙은 다음과 같다.
>
>- __첫째 법칙 : 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.__
>- __둘째 법칙 : 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.__
>- __셋째 법칙 : 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성하라.__
>
>
>위 3가지 규칙을 따르면 실제 코드와 테스트 코드는 함께 나올뿐더러 개발과 테스트가 대략 30초 주기로 묶인다.  
이렇게 일하면 실제 코드를 사실상 전부 테스트하는 테스트 케이스가 나온다.  
하지만 실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 한다.

<br>

### 깨끗한 테스트 코드 유지하기
>실제 코드가 진화하면 테스트 코드도 변해야 하기 때문에 테스트 코드가 복잡할수록 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸리기 십상이다. 그렇기에 테스트 코드는 계속해서 늘어나는 부담이 되버린다.  
하지만 테스트 슈트가 없으면 개발자는 자신이 수정한 코드가 제대로 도는지 확인할 방법이 없다. 테스트 슈트가 없으면 시스템 이쪽을 수정해도 저쪽이 안전하다는 사실을 검증하지 못한다. 그래서 결함율이 높아지고 이로 인해 개발자는 변경을 주저한다.
>
>__따라서, 테스트 코드는 실제 코드 못지 않게 중요하다.__
테스트는 변경을 쉬워지게 하기 때문에 유연성, 유지보수성, 재사용성을 제공한다. __즉, 코드에 유연성, 유지보수성, 재사용성을 제공하는 버팀목이 바로 _단위 테스트_ 다.__  
테스트 커버리지가 높을수록 버그에 대한 공포는 사라진다. 그러므로 실제 코드를 점검하는 자동화 단위 테스트 슈트는 설계와 아키텍처를 최대한 깨끗하게 보존하는 열쇠다.

<br>

### 깨끗한 테스트 코드
>깨끗한 테스트 코드를 만들기 위해선 가독성이 가장 중요하며 가독성을 높이기 위해서는 명료성, 단순성, 풍부한 표현력이 필요하다.  
BUILD-OPERATE-CHECK 패턴이 위와 같은 테스트 구조에 적합하다. 각 테스트는 정확히 세 부분으로 나눠진다.
>- 첫 부분은 테스트 자료를 만든다.
>- 두 번째 부분은 테스트 자료를 조작한다.
>- 세 번째 부분은 조작한 결과가 올바른지 확인한다.
>
>테스트 코드는 본론에 돌입해 진짜 필요한 자료 유형과 함수만 사용한다. 그러므로 코드를 읽는 사람이 온갖 잡다하고 세세한 코드에 주눅들지 않고 헷갈릴 필요 없이 코드가 수행하는 기능을 재빨리 이해할 수 있다.
<br>

>_도메인에 특화된 테스트 언어_  
도메인에 특화된 언어(DSL)로 테스트 코드를 구현하는 기법을 보여준다.  
흔히 쓰는 시스템 조작 API를 사용하는 대신 API 위에다 함수와 유틸리티를 구현한 후 그 함수와 유틸리티를 사용하므로 테스트 코드를 짜기도 읽기도 쉬워진다.
<br>

>_이중 표준_   
테스트 API 코드에 적용하는 표준은 실제 코드에 적용하는 표준과 확실히 다르다.  
테스트 코드는 단순하고, 간결하고, 표현력이 풍부해야 하지만, 실제 코드만큼 효율적일 필요는 없다.  
실제 환경과 테스트 환경은 요구사항이 판이하게 다르기 때문에 실제 환경에서는 절대로 안 되지만 테스트 환경에서는 전혀 문제없는 방식이 있다.

<br>

### 테스트 당 assert 하나
>JUnit으로 테스트 코드를 짤 때는 함수마다 assert 문을 단 하나만 사용해야 한다는 주장이 있다.
assert 문이 단 하나인 함수는 결론이 하나라서 코드를 이해하기 쉽고 빠르기 때문이다.
>
>테스트를 두 개로 쪼개 각자 assert를 수행하면 테스트 코드를 읽기 쉬워지지만 중복되는 코드가 많아진다.  
TEMPLATE METHOD 패턴을 사용하여 중복을 제거할 수 있지만 이것저것 감안해 보면 결국 assert문을 여럿 사용하는 편이 좋다.
저자는 '단일 assert 문'이라는 규칙이 휼륭한 지침이라 생각하며 **assert 문 개수를 최대한 줄이는 것이 좋다**고 말한다.  
<br>

>_테스트 당 개념 하나_  
가독성과 이해를 위한 가장 좋은 규칙은 __"개념 당 assert 문 수를 최소로 줄여라"__ 와 __"테스트 함수 하나는 개념 하나만 테스트하라"__ 이다.

<br>

### F.I.R.S.T
>깨끗한 테스트는 다음 다섯 가지 규칙을 따라야 한다.
>
>- __빠르게(Fast)__ : 테스트의 선순환을 위해 테스트는 빨라야 한다.
>- __독립적으로(Independent)__ : 정확한 원인 진단을 위해 각 테스트는 서로 의존하면 안 된다.
>- __반복가능하게(Repeatable)__ : 테스트는 어떤 환경에서도 반복 가능해야 한다.
>- __자가검증하는(Self-Validating)__ : 테스트는 Bool 값으로 결과를 내야 한다. 테스트가 스스로 성공과 실패를 가늠하지 않는다면 판단은 주관적이 되며 지루한 수작업 평가가 필요하게 된다.
>- __적시에(Timely)__ : 테스트는 적시에 작성해야 한다. 테스트의 적합성을 위해 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다.

<br>

### 결론
>테스트 코드는 실제 코드만큼이나 프로젝트 건강에 중요하다.   
테스트 코드는 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화하기 때문이다.  
그러므로 테스트 코드를 지속적으로 깨끗하게 관리하자.  
